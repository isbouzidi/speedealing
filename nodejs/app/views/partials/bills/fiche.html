<section data-ng-controller="BillController">
	<div data-ng-init="findOne()">
		<script type="text/ng-template" id="searchproduct.html">
            <a>
			<span bind-html-unsafe="match.model.product.id.ref | typeaheadHighlight:query"></span> - <span bind-html-unsafe="match.model.product.id.label"></span> (\{{match.model.price_level}} : \{{match.model.pu_ht|currency}})
            </a>
		</script>
		<hgroup id="main-title" class="thin">
			<h1>Facture \{{bill.ref}} (\{{bill.client.name}})</h1>
			<!--<span class="valign-top tag glossy" data-ng-class="bill.status.css">\{{bill.status.name}}</span>-->
		</hgroup>
		<div class="with-padding" data-ng-init="init()">
			<div class="columns">
				<div class="four-columns twelve-columns-mobile">
					<div class="boxed">
						<p class="icon-info green underline">{{t 'bills:CardBill'}}</p>

						<table class="info-table">
							<tbody>
								<tr>
									<th width="40%" scope="row">{{t 'Ref'}}</th>
									<td class="h5 blue">\{{bill.ref}}</td>
								</tr>
								<tr>
									<th scope="row">{{t 'Title'}}</th>
									<td class="h5"><a href="#" ng-hide="bill.title.autoGenerated" editable-text="bill.title.ref" buttons="no" onaftersave="update()">
											\{{bill.title.ref|| "Non défini"}}
										</a><span class="h5" ng-show="bill.title.autoGenerated">\{{bill.title.ref|| "Non défini"}}</span></td>
								</tr>
								<tr>
									<th scope="row">{{t 'Status'}}</th>
									<td><span class="tag small glossy" data-ng-class="bill.status.css">\{{bill.status.name}}</span>
									</td>
								</tr>
								<tr>
									<th scope="row">{{t 'bills:DateMaxPayment'}}</th>
									<td class="blue">\{{bill.dater|date:'dd/MM/yyyy'}}</td>
								</tr>
								<tr>
									<th scope="row">{{t 'bills:BillTo'}}</th>
									<td><a href="#" ng-show="editable" editable-text="bill.client" e-typeahead="societe as societe.name for societe in societeAutoComplete($viewValue, 'name') | filter:{name:$viewValue}" buttons="no"  onbeforesave="updateAddress($data)" onaftersave="update()">
											\{{bill.client.name|| "Non defini"}}
										</a>
										<span ng-hide="editable">\{{bill.client.name|| "Non defini"}}</span>
									</td>
								</tr>
								<tr>
									<th scope="row">{{t 'Entity'}}</th>
									<td><small class="tag anthracite-gradient glossy">\{{bill.entity}}</small></td>
								</tr>
								<tr>
									<th scope="row">{{t 'companies:Address'}}</th>
									<td>
										<form editable-form name="editableFormAddress" onaftersave="update()">
											<span editable-textarea="bill.address" e-name="address" e-rows="4" e-cols="20" e-required><pre class="no-padding">\{{ bill.address ||  "Non defini" }}</pre></span>

											<span editable-text="bill.zip" e-name="zip" e-placeholder="{{t 'companies:Zip'}}" e-title="{{t 'companies:Zip'}}">\{{bill.zip}}</span> <span editable-text="bill.town" e-name="town" e-placeholder="{{t 'companies:Town'}}" e-title="{{t 'companies:Town'}}">\{{bill.town}}</span>
											\{{bill.country}}
											<!-- button to show form -->
											<span type="button" class="icon-pencil grey" ng-click="editableFormAddress.$show()" ng-show="!editableFormAddress.$visible && editable"></span>


											<div class="small-margin-top button-group" ng-show="editableFormAddress.$visible">
												<button type="submit" class="button icon-tick blue-gradient" title="{{t 'Save'}}" ng-disabled="editableFormAddress.$waiting"></button>

												<button type="button" class="button icon-cross-round white-gradient" ng-disabled="editableFormAddress.$waiting" title="{{t 'Cancel'}}" ng-click="editableFormAddress.$cancel()"></button>
											</div>

										</form>
									</td>
								</tr>
								<!--<tr>
									<th scope="row">{{t 'companies:Phone'}}</th>
									<td ><span editable-tel="bill.phone" e-title="+xxxxxxxxxxx" buttons="no" e-form="phoneBtnForm" onaftersave="update()">\{{bill.phone|| "Non défini" | phone}}</span> <span class="icon-pencil grey" ng-click="phoneBtnForm.$show()" ng-hide="phoneBtnForm.$visible"></span></td>
								</tr>
								<tr>
									<th scope="row">{{t 'companies:Fax'}}</th>
									<td><span editable-tel="bill.fax" e-title="+xxxxxxxxxxx" buttons="no" e-form="faxBtnForm" onaftersave="update()">\{{bill.fax|| "Non défini"}}</span> <span class="icon-pencil grey" ng-click="faxBtnForm.$show()" ng-hide="faxBtnForm.$visible"></span></td>
								</tr>
								<tr>
									<th scope="row">{{t 'EMail'}}</th> 
									<td><a data-ng-href="mailto:\{{bill.email}}" target="_blank" editable-email="bill.email" buttons="no" e-form="eMailBtnForm" onaftersave="update()">\{{bill.email|| "Non defini"}}</a>
										<span class="icon-pencil grey" ng-click="eMailBtnForm.$show()" ng-hide="eMailBtnForm.$visible"></span></td>
								</tr>-->
								<tr>
									<th scope="row">{{t 'DateLastModification'}}</th>
									<td class="blue">\{{bill.updatedAt|date:'dd/MM/yyyy HH:mm'}}</td>
								</tr>
								<tr ng-show='bill.Status != "DRAFT"'>
									<th scope="row">{{t 'DownloadPDF'}}</th>
									<td><ul class="files-icons">
											<li style="height: inherit"><a data-ng-href="api/bill/pdf/\{{bill._id}}" target="_blank" class="file-link">
													<span class="icon file-pdf"></span>
													\{{bill.ref}}.pdf
												</a></li>
										</ul>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="eight-columns small-margin-bottom">

					<div class="float-right button-height">					
						<button ng-show="editable" class="button" data-ng-click="changeStatus('NOT_PAID')">
							<span class="button-icon green-gradient"><span class="icon-like"></span></span>
							{{t 'Validate'}}
						</button>
						<button ng-hide="editable || bill.Status == 'PAID'" class="button" data-ng-click="changeStatus('DRAFT')">
							<span class="button-icon orange-gradient"><span class="icon-unlike"></span></span>
							{{t 'ReOpen'}}
						</button>

						<button ng-hide="editable || bill.Status == 'PAID'" class="button" data-ng-click="changeStatus('PAID')">
							<span class="button-icon green-gradient"><span class="icon-credit-card"></span></span>
							{{t 'bills:ClassifyPaid'}}
						</button>


						<button class="button" data-ng-click="clone()">
							<span class="button-icon anthracite-gradient"><span class="icon-pages"></span></span>
							{{t 'ToClone'}}
						</button>

						<!-- Right side -->
						<button class="button margin-left" ng-disabled="!global.user.rights.bill.delete" ng-show="bill.Status == 'DRAFT'" confirmed-click="remove(bill)" ng-confirm-click="Supprimer la facture ?" title="Supprimer la facture">
							{{t 'Delete'}}
							<span class="button-icon right-side red-gradient"><span class="icon-trash"></span></span>
						</button>
					</div>
				</div>
				<div class="eight-columns">

					<tabset>
						<tab>
							<tab-heading>
								<span class="icon-tools">{{t 'bills:CardBill'}}</span>
							</tab-heading>
							<div class="boxed relative large-box-shadow">
								<div class="columns">
									<div class="six-columns">
										<table class="simple-table">
											<tbody>
												<tr>
													<th scope="row">{{t 'Type'}}</th>
													<td><span editable-select="bill.type" buttons="no" e-form="typeBtnForm" onaftersave="update()" e-ng-options="s.id as s.label for s in dict.fk_bill_type.values">
															\{{showStatus('type', 'fk_bill_type')}}</span> <span class="icon-pencil grey" ng-show="editable && !typeBtnForm.$visible" ng-click="typeBtnForm.$show()"></span>
													</td>
												</tr>
												<tr>
													<th scope="row">{{t 'bills:Date'}}</th>
													<td><a href="#" ng-show="editable" editable-bsdate="bill.datec" e-datepicker-popup="dd/MM/yyyy" buttons="no" onaftersave="update()">
															\{{ (bill.datec | date:"dd/MM/yyyy") || 'empty'}}
														</a>
														<span ng-hide="editable">\{{ (bill.datec | date:"dd/MM/yyyy") || 'empty'}}</span></td>
												</tr>
												<tr>
													<th scope="row">{{t 'RefCustomer'}}</th>
													<td><a href="#" editable-text="bill.ref_client" buttons="no" onaftersave="update()">
															\{{bill.ref_client|| "Non défini"}}
														</a></td>
												</tr>
												<tr>
													<th scope="row">{{t 'products:PriceLevel'}}</th>
													<td class='h5 strong'>\{{bill.price_level}}</td>
												</tr>
												<tr>
													<th scope="row">{{t 'bills:PaymentConditions'}}</th>
													<td><a href="#" editable-select="bill.cond_reglement_code" buttons="no" e-ng-options="s.id as s.label for s in dict.fk_payment_term.values" onaftersave="update()">
															\{{ showStatus('cond_reglement_code', 'fk_payment_term')}}
														</a>
													</td>
												</tr>
												<tr>
													<th scope="row">{{t 'bills:PaymentMode'}}</th>
													<td><a href="#" editable-select="bill.mode_reglement_code" buttons="no" e-ng-options="s.id as s.label for s in dict.fk_paiement.values" onaftersave="update()">
															\{{ showStatus('mode_reglement_code', 'fk_paiement')}}
														</a>
													</td>
												</tr>
												<tr>
													<th scope="row">{{t 'commercial:Commercial'}}</th>
													<td ><a href="#" ng-show="editable" editable-text="bill.commercial_id" e-typeahead="user as user.name for user in userAutoComplete($viewValue, 'name') | filter:{name:$viewValue}" buttons="no" onaftersave="update()">
															\{{bill.commercial_id.name|| "Non defini"}}
														</a>
														<span ng-hide="editable">\{{bill.commercial_id.name|| "Non defini"}}</span>
													</td>
												</tr>
											</tbody>
										</table>
									</div>
									<div class="two-columns"></div>
									<div class="four-columns">
										<p class="icon-plane green underline no-margin-bottom">Frais de transport</p>
										<table class="info-table">
											<tbody>
                                                <tr>
                                                    <th>{{t 'AmountHT'}}</th>
                                                    <td class="align-right">
                                                        <a href="#" 
														   editable-text="bill.shipping.total_ht"
														   e-style="width: 80px"
														   blur="submit"
														   buttons="no"
														   onaftersave="update()"
														   e-form="shipping">
															\{{bill.shipping.total_ht| currency}}
														</a>
														<span class="icon-pencil grey" ng-click="shipping.$show()" ng-hide="shipping.$visible"></span>

                                                    </td>
                                                </tr>
                                            </tbody>
										</table>

										<p class="icon-info green underline margin-top no-margin-bottom">{{t 'Totaux'}}</p>
										<table class="info-table">
											<tbody>
												<tr>
													<th>{{t 'AmountHT'}}</th>
													<td class="align-right">\{{bill.total_ht| currency}}</td>
												</tr>
												<tr>
													<th>{{t 'AmountVAT'}}</th><td></td>
												</tr>
												<tr>
													<td class="no-padding" colspan="2">
														<table class="info-table">
															<tbody>
																<tr ng-repeat="vat in bill.total_tva| orderBy:'tva_tx'">
																	<th class="align-right">\{{vat.tva_tx| number:2}} %</th>
																	<td class="align-right">\{{vat.total| currency}}</td>
																</tr>
															</tbody>
														</table>
													</td>
												</tr>
												<tr>
													<th>{{t 'AmountTTC'}}</th>
													<td class="strong h5 blue align-right">\{{bill.total_ttc| currency}}</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>


							</div>
						</tab>
						<!--<tab>
							<tab-heading>
								<span class="icon-tools">Facturation</span>
							</tab-heading>
							<div class="boxed relative large-box-shadow">
								<div class="columns">
									<div class="six-columns">
										<table class="simple-table">
											<tbody>
												<tr>
													<th scope="row">{{t 'compta:CustomerAccountancyCode'}}</th>
													<td>\{{bill.customeraccountancycode}}</td>
												</tr>
												<tr>
													<th scope="row">{{t 'compta:SupplierAccountancyCode'}}</th>
													<td>\{{bill.code_compta_fournisseur}}</td>
												</tr>
												<tr>
													<th scope="row">{{t 'companies:VATIsUsed'}}</th>
													<td >\{{bill.tva_assuj}}</td>
												</tr>
												<tr>
													<th scope="row">{{t 'companies:VATIntra'}}</th>
													<td>\{{bill.tva_intra}}</td>
												</tr>
												<tr>
													<th scope="row">{{t 'bills:PaymentConditions'}}</th>
													<td>\{{bill.cond_reglement}}</td>
												</tr>
												<tr>
													<th scope="row">{{t 'bills:PaymentMode'}}</th>
													<td>\{{bill.mode_reglement}}</td>
												</tr>
												<tr>
													<th scope="row">{{t 'companies:PriceLevel'}}</th>
													<td>\{{bill.price_level}}</td>
												</tr>
												<tr>
													<th scope="row">{{t 'companies:CustomerRelativeDiscountShort'}}</th>
													<td>\{{bill.remise_client}}</td>
												</tr>
												<tr>
													<th scope="row">{{t 'banks:RIB'}}</th>
													<td>\{{bill.iban}}</td>
												</tr>
												<tr>
													<th scope="row">{{t 'companies:ThirdPartyBilling'}}</th>
													<td>\{{bill.cptBilling}}</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</tab>
						<tab disabled="bill.fournisseur=='NO'">
							<tab-heading>
								<span class="icon-box">Fournisseur</span>
							</tab-heading>
							<div class="boxed relative large-box-shadow">
								<div class="columns">
									<div class="six-columns">
										<table class="simple-table">
											<tbody>
												<tr>
													<th scope="row">{{t 'Categories'}}</th>
													<td>\{{bill.Tag}}</td>
												</tr>

											</tbody>
										</table>
									</div>
								</div>
							</div>
						</tab>
						<tab>
							<tab-heading>
								<span class="icon-tick">Checklist<span ng-show='checklist' class="count right">\{{checklist}}</span></span>
							</tab-heading>
							<div class="boxed relative large-box-shadow">
								<div class="columns">
									<div class="six-columns">
										<table class="simple-table">
											<tbody>
												<tr>
													<th width="90%" scope="row">Extrait KBIS (moins de 3 mois)</th>
													<td><input type="checkbox" data-ng-model="bill.checklist.KBIS" data-ng-checked="bill.checklist.KBIS" data-ng-change="update()" />
													</td>
												</tr>
												<tr ng-show="bill.fournisseur=='SUBCONTRACTOR'">
													<th scope="row">Licences nationale et communautaire</th>
													<td><input type="checkbox" data-ng-model="bill.checklist.licencesNationaleCommunautaire" data-ng-checked="bill.checklist.licencesNationaleCommunautaire" data-ng-change="update()" />
													</td>
												</tr>
												<tr ng-show="bill.fournisseur=='SUBCONTRACTOR'">
													<th scope="row">Attestation de régularité fiscale</th>
													<td><input type="checkbox" data-ng-model="bill.checklist.attestationRegulFiscale" data-ng-checked="bill.checklist.attestationRegulFiscale" data-ng-change="update()" />
													</td>
												</tr>
												<tr ng-show="bill.fournisseur=='SUBCONTRACTOR'">
													<th scope="row">Attestation URSAFF</th>
													<td><input type="checkbox" data-ng-model="bill.checklist.attetationUrsaff" data-ng-checked="bill.checklist.attetationUrsaff" data-ng-change="update()" />
													</td>
												</tr>
												<tr ng-show="bill.fournisseur=='SUBCONTRACTOR'">
													<th scope="row">Attestation d'assurance à jour - Responsabilité Civile et Marchandise Transportée</th>
													<td><input type="checkbox" data-ng-model="bill.checklist.attestationAssurance" data-ng-checked="bill.checklist.attestationAssurance" data-ng-change="update()" />
													</td>
												</tr>
												<tr ng-show="bill.fournisseur=='SUBCONTRACTOR'">
													<th scope="row">Attestation sur l'honneur</th>
													<td><input type="checkbox" data-ng-model="bill.checklist.attestationHonneur" data-ng-checked="bill.checklist.attestationHonneur" data-ng-change="update()" />
													</td>
												</tr>
												<tr ng-show="bill.fournisseur=='SUBCONTRACTOR'">
													<th scope="row">Copie Permis de conduire et Déclaration Unique d'Embauche (DUE)</th>
													<td><input type="checkbox" data-ng-model="bill.checklist.permisConduireDUE" data-ng-checked="bill.checklist.permisConduireDUE" data-ng-change="update()" />
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</tab>-->
						<tab>
							<tab-heading>
								<span class="icon-pencil">Notes<span ng-if='bill.notes.length' class="count orange-bg right">\{{bill.notes.length}}</span></span>
							</tab-heading>
							<div class="boxed relative large-box-shadow">

								<div class="columns">
									<div class="six-columns">
										<div class="button-height block-label margin-bottom">
											<h5 for="note" class="underline green">
												Ajouter une note
											</h5>
											<textarea id="note" cols="30" rows="5" data-ng-model="note" class="input full-width"></textarea>

											<div class="margin-top button-height float-right">
												<button type="button" data-ng-click="addNote()" class="button icon-plus blue-gradient">{{t 'Add'}}</button>
											</div>
										</div>
									</div>


									<div class="six-columns">
										<div class="scroll" style="height:200px">
											<div data-ng-repeat="vnote in bill.notes| orderBy:'-datec'" class="large-box-shadow white-gradient with-border margin-bottom">
												<div class="with-small-padding silver-gradient no-margin-top">
													<span class="icon-speech"><b>\{{vnote.author.name}}</b> <i>\{{vnote.datec| date:'dd-MM-yyyy HH:mm:ss'}}</i></span>
													<div class="float-right" title="{{t 'ticket:TimeCreate'}}" data-ng-init='timeComment = countDown(vnote.datec, false)'><span data-ng-show="timeComment.days > 0">\{{timeComment.days}}j</span><span data-ng-hide="timeComment.days > 0">{{t 'Today'}}</span></div>
												</div>
												<pre class="with-small-padding" data-ng-if="vnote.note">\{{vnote.note}}</pre>
											</div>
										</div>
									</div>
								</div>


							</div>
						</tab>
						<tab ng-if="countTicket">
							<tab-heading>
								<span class="icon-ticket">Tickets<span ng-show='countTicket' class="count black-bg right">\{{countTicket}}</span></span>
							</tab-heading>
							<div class="boxed relative large-box-shadow">
								<!--<div class="table-header silver-gradient glossy button-height">
									<div class="float-right">
										{{t 'Search'}} <input type="text" data-ng-model="filterOptionsTicket.filterText" class="input small mid-margin-left">
									</div>
								</div>-->
								<div class="gridStyle"  data-ng-grid="gridOptionsTicket"></div>
								<!--<div class="table-footer silver-gradient">
									\{{countTicket}} ligne(s)
								</div>-->
							</div>
						</tab>
						<tab ng-if="bill.orders.length">
							<tab-heading>
								<span class="icon-bag">{{t 'orders:Orders'}}<span class="count green-bg right">\{{bill.orders.length}}</span></span>
							</tab-heading>

							<div class="boxed relative large-box-shadow">
								<ul class="list spaced">
									<li ng-repeat="order in bill.orders">
										<a ng-href="commande/fiche.php?id=\{{order._id}}" class="list-link icon-bag" title="Click to show">
											<strong>\{{order.ref}} (\{{order.client.name}})</strong> <small> - \{{order.ref_client}}</small>
										</a> Total HT : \{{order.total_ht|currency}}
									</li>
								</ul>
								<span class="blue h5">Total HT : \{{totalOrders| currency}}</span>
							</div>

						</tab>
						<tab ng-if="bill.deliveries.length">
							<tab-heading>
								<span class="icon-plane">{{t 'deliveries:Deliveries'}}<span class="count green-bg right">\{{bill.deliveries.length}}</span></span>
							</tab-heading>

							<div class="boxed relative large-box-shadow">
								<ul class="list spaced">
									<li ng-repeat="delivery in bill.deliveries">
										<a ng-href="#!/delivery/\{{delivery._id}}" class="list-link icon-plane" title="Click to show">
											<strong>\{{delivery.ref}} (\{{delivery.client.name}})</strong> <small> - \{{delivery.ref_client}}</small>
										</a> Total HT : \{{delivery.total_ht|currency}}
									</li>
								</ul>
								<span class="blue h5">Total HT : \{{totalDeliveries| currency}}</span>
							</div>

						</tab>
					</tabset>
				</div>

				<div class="twelve-columns">
					<h5 class="green underline">{{t 'bills:Details'}}</h5>

					<!--<div class="table-header silver-gradient glossy button-height">
						<div class="row">
							<div class="col-sm-8">
								<div class="button-group">
									<button class="button icon-plus blue-gradient" ng-disabled="!editable" data-ng-click="addNewLine()">{{t 'Add'}}</button>
									<button title="{{t 'Refresh'}}" class="button" data-ng-click="findOne()"><span class="icon-redo"></span></button>
								</div>
							</div>
							<div class="col-sm-4">
								<div class="float-right">
									{{t 'Search'}} <input type="text" data-ng-model="filterOptionsLines.filterText" class="input small mid-margin-left">
								</div>
							</div>
						</div>
					</div>
					<div class="gridStyle"  data-ng-grid="gridOptionsLines" ng-style="style(200)" resize></div>
					<div class="table-footer silver-gradient">
						<div class="float-right strong">
							Total HT : \{{bill.total_ht| currency}}  
						</div>
						\{{bill.lines.length}} ligne(s)
					</div>-->

					<form editable-form name="tableform" onaftersave="update()" oncancel="cancel()">
						<!-- table -->
						<table class="table table-bordered table-hover table-condensed">
							<tr style="font-weight: bold">
								<td >Code produit</td>
								<td>Nom</td>
								<td>Description</td>
								<td >Nbr de pièces</td>
								<td >Qté facturée</td>
								<td >Prix HT</td>
								<td >Remise %</td>
								<td >TVA %</td>
								<td >Total HT</td>
								<td ><span ng-show="tableform.$visible">Action</span></td>
							</tr>
							<tr ng-repeat="line in bill.lines| filter:filterLine">
								<td>
									<span editable-text="line.product.name" 
										  e-typeahead="product as product.name for product in productAutoComplete($viewValue, 'name')"
										  e-typeahead-template-url="searchproduct.html"
										  e-typeahead-on-select ="addProduct($item, line.idLine)"
										  e-form="tableform"
										  onbeforesave="checkLine($data)"
										  e-style="width: 140px">
										\{{ line.product.name || 'empty' }}
									</span>

								</td>
								<td>
									<span editable-text="line.product.label" e-style="width: 140px" e-form="tableform">
										\{{ line.product.label || 'empty' }}
									</span>
								</td>
								<td>
									<!-- editable username (text with validation) -->
									<span editable-textarea="line.description" e-rows="4" e-cols="50" e-style="width: 180px" e-form="tableform">
										<pre class="no-padding small">\{{ line.description || 'empty' }}</pre>
									</span>
								</td>
								<td class="align-right">
									<span editable-number="line.no_package" e-min="0" e-step="0.1" e-style="width: 60px" e-form="tableform">
										\{{ line.no_package || 0 }}
									</span>
								</td>
								<td class="align-right">
									<span editable-number="line.qty" e-ng-change="calculMontantHT(line, $data, 'qty')" e-min="0" e-step="0.001" e-style="width: 80px" e-form="tableform">
										\{{ line.qty || 0 }}
									</span>
								</td>
								<td class="align-right">
									<span editable-number="line.pu_ht" e-ng-change="calculMontantHT(line, $data, 'pu_ht')" e-min="0" e-step="0.001" e-style="width: 80px" e-form="tableform">
										\{{ line.pu_ht || 0 | number:3}}
									</span>
								</td>
								<td class="align-right">
									<span editable-number="line.discount" e-style="width: 60px" e-ng-change="calculMontantHT(line, $data, 'discount')" e-min="0" e-step="0.001" e-form="tableform">
										\{{ line.discount || 0 | percent:3}}
									</span>
								</td>
								<td class="align-right">
									<span editable-select="line.tva_tx" e-style="width: 60px" e-form="tableform" e-ng-options="c.value as c.value for c in dict.fk_tva.values">
										\{{ line.tva_tx|percent:2}}
									</span>
								</td>
								<td class="align-right">
									<span ng-model="montantHT[$index]" form="tableform" style="width: 60px"">
										\{{ line.total_ht | number:3 }}
									</span>
								</td>
								<td>
									<div class="btn-toolbar" role="toolbar">
										<div class="btn-group btn-group-sm">
											<button type="button" ng-show="!tableform.$visible && editable" ng-disabled="$index == 0" ng-click="upDownLine($index, 'UP')" class="btn btn-default glyphicon glyphicon-chevron-up" title="Monter"></button>
											<button type="button" ng-show="!tableform.$visible && editable" ng-disabled="$index == (delivery.lines.length - 1)" ng-click="upDownLine($index, 'DOWN')" class="btn btn-default glyphicon glyphicon-chevron-down" title="Descendre"></button>
										</div>
										<div class="btn-group btn-group-sm">
											<button type="button" ng-show="tableform.$visible" ng-click="deleteLine(line.idLine)" class="btn btn-danger glyphicon glyphicon-trash" title="Supprimer"></button>
										</div>
									</div>
								</td>
							</tr>
						</table>

						<!-- buttons -->
						<div class="btn-edit">
							<button type="button" class="btn btn-default" ng-show="!tableform.$visible && editable" ng-click="tableform.$show()">
								{{t 'Modify'}}
							</button>
						</div>
						<div class="btn-form" ng-show="tableform.$visible">
							<button type="button" ng-disabled="tableform.$waiting" ng-click="addLine()" class="btn btn-default pull-right">{{t 'AddNewLine'}}</button>
							<button type="submit" ng-disabled="tableform.$waiting" class="btn btn-primary">{{t 'Save'}}</button>
							<button type="button" ng-disabled="tableform.$waiting" ng-click="tableform.$cancel()" class="btn btn-default">{{t 'Cancel'}}</button>
						</div> 

					</form>

				</div>

			</div>
		</div>
	</div>
</section>